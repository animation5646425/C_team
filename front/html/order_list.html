<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>注文書一覧</title>
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/order_list.css">
</head>
<body>
    <!-- ハンバーガーメニューボタン -->
    <div class="menu-btn" id="menuBtn">&#9776;</div>
    <!-- サイドバー背景（モーダル用） -->
    <div class="sidebar-bg" id="sidebarBg"></div>
    <!-- サイドバー -->
    <nav class="sidebar" id="sidebar">
        <span class="sidebar-close" id="sidebarClose">&times;</span>
        <ul>
            <li><a href="/html/home.html">・<u>HOME</u></a></li>
            <li><a href="/html/order_list.html">・注文書一覧</a></li>
            <li><a href="/html/delivery_list.html">・納品書一覧</a></li>
            <li><a href="/html/statistics_list.html">・統計情報一覧</a></li>
            <li><a href="/html/customer_register.html">・顧客情報登録</a></li>
        </ul>
    </nav>
    <!-- メインコンテンツ -->
    <div class="main" id="main">
        <h1 class="orders-title">注文書一覧</h1>
        <div class="search-toolbar">
            <div class="search-area">
                <span class="search-icon">🔍</span>
                <input type="text" class="search-input" placeholder="注文書No.、注文内容">
                <button class="filter-btn"><span class="filter-icon">⏷</span></button>
            </div>
        </div>
        <div class="orders-table-area">
            <table class="orders-table">
                <thead>
                    <tr>
                        <th style="width:32px;"></th>
                        <th style="width:90px;">注文書No.</th>
                        <th style="width:110px;">顧客ID</th>
                        <th style="width:160px;">顧客名</th>
                        <th style="width:180px;">注文内容</th>
                        <th style="width:120px;">電話番号</th>
                        <th style="width:100px;">注文日</th>
                        <th style="width:100px;">納品予定</th>
                        <th style="width:80px;">備考</th>
                    </tr>
                </thead>
                <tbody id="orders-tbody">
                    <!-- ここにJSで注文データを挿入 -->
                </tbody>
            </table>
        </div>
        <div class="orders-btns-row">
            <a href="order_form.html" class="btn create">新規注文書作成</a>
            <button class="btn delete-btn">注文書削除</button>
        </div>
        <script>
        // サイドバー開閉
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarBg = document.getElementById('sidebarBg');
        const sidebarClose = document.getElementById('sidebarClose');
        function openSidebar() {
            sidebar.classList.add('open');
            sidebarBg.classList.add('show');
        }
        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarBg.classList.remove('show');
        }
        menuBtn.onclick = openSidebar;
        sidebarClose.onclick = closeSidebar;
        sidebarBg.onclick = closeSidebar;

        // 注文書一覧をAPIから取得して表示
        fetch('http://localhost:3000/api/orders')
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('orders-tbody');
                tbody.innerHTML = '';
                data.forEach(order => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="checkbox"></td>
                        <td>${order.orderId}</td>
                        <td>${order.customerId}</td>
                        <td>${order.customerName}</td>
                        <td>${order.orderDetail}</td>
                        <td>${order.phone}</td>
                        <td>${order.orderDate}</td>
                        <td>-</td>
                        <td>${order.note || ''}</td>
                    `;
                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                console.error('注文データ取得エラー:', err);
            });

        // 保存ボタンでAPIに注文書を登録
        document.getElementById('saveBtn').onclick = async function() {
            // ...入力値の取得...
            // ...バリデーション...
            const res = await fetch('http://localhost:3000/api/orders', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    customerId,
                    customerName,
                    orderDetail,
                    orderDate,
                    phone,
                    note
                })
            });
            if (res.ok) {
                alert('注文書を登録しました');
                location.href = 'order_list.html'; // 一覧へ遷移
            } else {
                const err = await res.json();
                alert('エラー: ' + err.error);
            }
        };
        </script>
    </div>
</body>
</html>